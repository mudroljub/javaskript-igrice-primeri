<html>
<head>
	<meta charset="UTF-8">
    <title>Glupi gusan</title>
	
<script>
//mozda prepraviti u luk i strelu
var sirinaPlatna = 1200;
var visinaPlatna = 600;
var platno;
var podloga1;
var svipredmeti = [];
var ponavljanje;
var pracka_x = 150;
var pracka_y = 200;
var djule_x = pracka_x;
var djule_y = pracka_y;
var djule_poluprec = 10;
var poluprec_na2 = djule_poluprec * djule_poluprec;
var zateze = false; 
var horizontalBrzina;
var vertikalBrzina1;
var vertikalBrzina2;
var gravitacija = 2;  //otprilike, videti kako se pona≈°a
var gusan = new Image();
	gusan.src = "gusan.png";
var perje = new Image();
	perje.src = "perje.gif";

//pravi predmete sa metodom crtanje
function Pracka(djx,djy,p1x,p1y,p2x,p2y,p3x,p3y,stylestring) {
	this.djx = djx;
	this.djy = djy;
	this.p1x = p1x;
	this.p1y = p1y;
	this.p2x = p2x;
	this.p2y = p2y;
	this.p3x = p3x;
	this.p3y = p3y;
	this.strokeStyle = stylestring;
	this.crta = crtaPracku;
	this.zatezePracku = mrdaPracku;	
}

function crtaPracku() {
	platno.strokeStyle = this.strokeStyle;
	platno.lineWidth = 4;
	platno.beginPath();
	platno.moveTo(this.djx,this.djy);
	platno.lineTo(this.p1x,this.p1y);
	platno.moveTo(this.djx,this.djy);
	platno.lineTo(this.p2x,this.p2y);
	platno.moveTo(this.p1x,this.p1y);
	platno.lineTo(this.p2x,this.p2y);
	platno.lineTo(this.p3x,this.p3y);
	platno.stroke();
}

function mrdaPracku(dx,dy) {
	this.djx +=dx;
	this.djy +=dy;
	this.p1x +=dx;
	this.p1y +=dy;
	this.p2x +=dx;
	this.p2y +=dy;
	this.p3x +=dx;
	this.p3y +=dy;
}

var pracka = new Pracka(pracka_x, pracka_y, pracka_x+80, pracka_y-10, pracka_x+80,
					    pracka_y+10, pracka_x+70, pracka_y+180, "rgb(120,20,10)");

function Djule(px,py,rad,stylestring) {
  this.px = px;
  this.py = py;
  this.rad = rad;
  this.crta = crtaDjule;
  this.zatezePracku = mrdaDjule;
  this.fillstyle = stylestring;
}

function crtaDjule() {
	platno.fillStyle=this.fillstyle;
	platno.beginPath();
	platno.arc(this.px,this.py,this.rad,0,Math.PI*2,true);
	platno.fill();	
}

function mrdaDjule(dx,dy) {
	this.px +=dx;
	this.py +=dy;
}

var djule = new Djule(pracka_x,pracka_y,djule_poluprec,"rgb(250,0,0)");

function Kvadrat(px,py,swidth,sheight,stylestring) {
	this.px = px;
	this.py = py;
	this.swidth = swidth;
	this.sheight = sheight;
	this.fillstyle = stylestring;
	this.crta = crtaKvadrat;
	this.zatezePracku = mrdaKvadrat;
}

function crtaKvadrat() {
	platno.fillStyle = this.fillstyle;
	platno.fillRect(this.px,this.py,this.swidth,this.sheight);	
}

function mrdaKvadrat(dx,dy) {
   this.px += dx;
   this.py += dy;
}

function Slika (px,py,swidth,sheight,imga) {
	this.px = px;
	this.py = py;
	this.img = imga;
	this.swidth = swidth;
	this.sheight = sheight;
	this.crta = crtaSliku;
}

function crtaSliku() {
	platno.drawImage(this.img,this.px,this.py,this.swidth,this.sheight);
	
}

var meta = new Slika(700,210,209,179,gusan);
var tlo = new Kvadrat(0,370,1200,30,"rgb(10,250,0)");

svipredmeti.push(meta);
svipredmeti.push(tlo);

svipredmeti.push(pracka);
svipredmeti.push(djule);

//postavlja platno for drawing and podloga1 for events
function init(){
   platno = document.getElementById('canvas').getContext('2d');
   podloga1 = document.getElementById('canvas');
   podloga1.addEventListener('mousedown',traziDjule,false);
   podloga1.addEventListener('mousemove',zatezePracku,false);
   podloga1.addEventListener('mouseup',puca,false);
 //initial drawing 
  crtaPlatno();  
} 

function traziDjule(ev) {
	var mx;
	var my;
	if (ev.layerX ||  ev.layerX == 0) { // Firefox, Chrome
   			mx = ev.layerX;
    		my = ev.layerY;
  		} else if (ev.offsetX || ev.offsetX == 0) { // Opera,
    		mx = ev.offsetX;
    		my = ev.offsetY;
  		}
	if (razmak_na2(mx,my, djule.px,djule.py) < poluprec_na2) {
		zateze = true;
		crtaPlatno();
	}
}
//use square of distance to lesson computation
function razmak_na2(x1,y1,x2,y2) {
	return (x1-x2)*(x1-x2) + (y1-y2)*(y1-y2);
}
//for dragging of ball and modification of pracka
function zatezePracku(ev) {
	var mx;
	var my;
	if (zateze) {
		if ( ev.layerX ||  ev.layerX == 0) { // Firefox
   			mx= ev.layerX;
    		my = ev.layerY;
  		} else if (ev.offsetX || ev.offsetX == 0) { // Opera
    		mx = ev.offsetX;
    		my = ev.offsetY;
  		}
	djule.px = mx;
	djule.py = my;
	pracka.djx = mx;
	pracka.djy = my;
	crtaPlatno();
	}
}

function puca(ev) {
//at mouse up, if ball and pracka have been dragged, set up for ball to travel
// in ballistic arc.
	if (zateze) {
		zateze = false;
//want initial velocity to increase with length, make it the square for convenience
//the 700 is arbitrary. It makes a nice arc!
	var duzinacevi = razmak_na2(pracka.djx,pracka.djy,pracka.p1x,pracka.p1y)/700;
//use angle based on line interval djx,djy to p1x,p1y, the upper arm of sling
	var ugaoradijani = -Math.atan2(pracka.p1y-pracka.djy,pracka.p1x-pracka.djx);
	horizontalBrzina =  duzinacevi*Math.cos(ugaoradijani);
	vertikalBrzina1 = - duzinacevi*Math.sin(ugaoradijani);
	crtaPlatno();
	ponavljanje = setInterval(djuleLeti,100);
	}
}

function crtaPlatno() {
//crtaPlatno erases the whole canvas and then draws svipredmeti in svipredmeti array
	platno.clearRect(0,0,sirinaPlatna,visinaPlatna);
	var i;
	for (i=0;i<svipredmeti.length;i++) {
		svipredmeti[i].crta();
	}
}

function djuleLeti() {
//this creates the motion of the ball from the slingshot to either the meta or the tlo
	var dx = horizontalBrzina;
	vertikalBrzina2 = vertikalBrzina1 + gravitacija;
	var dy = (vertikalBrzina1 + vertikalBrzina2)*.5;
	vertikalBrzina1 = vertikalBrzina2;
	djule.zatezePracku(dx,dy);
	//check for hitting meta
	var djx = djule.px;
	var djy = djule.py;
	// proverava pogodak i smanjuje granice mete
	if ( (djx >= meta.px+40) && (djx <= (meta.px+meta.swidth-40) ) &&
		(djy >= meta.py+40) && (djy <= (meta.py+meta.sheight-40)) ) {
		//menja sliku u perje
		meta.img = perje;
	}
	//check for getting beyond tlo level
	if (djy>=tlo.py) {
		clearInterval(ponavljanje);
	}
	crtaPlatno();	
}

</script>
</head>

<body onLoad="init();">  

	<canvas id="canvas" width="1200" height="600">
	Your browser doesn't support the HTML5 element canvas.
	</canvas>  
	<br/>

	Mouse down and drag ball. Releasing the mouse button will shoot the slingshot.  Slingshot remains at the last position. Reload page to try again.
	
</body>
</html>